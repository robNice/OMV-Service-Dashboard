- uses: actions/checkout@v4

- name: Install rsync
  run: |
    apt-get update && apt-get install -y --no-install-recommends rsync

- name: Copy to mounted target
  run: |
    rsync -rltD --delete --omit-dir-times --no-perms \
      --exclude '.git' --exclude '.forgejo' \
      ./ /deploy/

- name: Rebuild & restart
  run: |
    cd /deploy && \
    if [ -f docker-compose.yml ] || [ -f compose.yml ]; then
      docker compose up -d --build || docker-compose up -d --build
    else
      echo "No compose file â€“ skipping rebuild"
    fi
